select * from t_member where member_phone='13616277820';

MPOS153030155965536

select * from  t_star_member_sales where order_no='559760877499358408';
select * from  t_star_member_sales_detail where order_no='559760877499358408';

select * from t_tk_order where trade_parent_id='559760877499358408';


update t_star_member_sales_detail set amount=-2236.02000 where order_no='MPOS153130194148064' and item_num_id=432204 and operate_type=2;
update t_star_member_sales_detail set sale_amount=0  where order_no='MPOS153130194148064' and item_num_id=432204 and operate_type=1;

#查询单个修改单个
update t_star_member_sales a inner join 
(select order_no,member_id,sum(amount) as sale_amount,sum(case when amount<0 then amount else 0 end) as refund_amount  from t_star_member_sales_detail where 
order_no in ('MPOS153030191780736'
) group by order_no,member_id ) b
on a.order_no=b.order_no and a.member_id=b.member_id
set a.sale_amount=b.sale_amount,a.refund_amount=b.refund_amount
where a.order_no in ('MPOS153030191780736'
) ;


update t_star_member_sales a inner join 
(select order_no,member_id,sum(amount) as sale_amount,sum(case when amount<0 then amount else 0 end) as refund_amount  from t_star_member_sales_detail where 
order_no in ('MPOS153030155965536', 
'MPOS153060126448927', 
'MPOS153060126772312', 
'MPOS153070157455700', 
'MPOS153080171934408', 
'MPOS153080110149663', 
'MPOS153080106141595', 
'MPOS153080116586919', 
'MPOS153080117627789', 
'MPOS153090180444589', 
'MPOS153090121442935', 
'MPOS153090123197648', 
'MPOS153100194712887', 
'MPOS153100167683633', 
'MPOS153120118403356', 
'MPOS153130133731407', 
'MPOS153130188876641', 
'MPOS153130151737105', 
'MPOS153100129432919', 
'MPOS153130130423876', 
'MPOS153130141616805', 
'MPOS153130121407195', 
'MPOS153130114047918', 
'MPOS153130134893508', 
'MPOS153130192454812', 
'MPOS153130134747495', 
'MPOS153130174365095', 
'MPOS153130106946130', 
'MPOS153130163238333'
) group by order_no,member_id ) b
on a.order_no=b.order_no and a.member_id=b.member_id
set a.sale_amount=b.sale_amount,a.refund_amount=b.refund_amount
where a.order_no in ('MPOS153030155965536', 
'MPOS153060126448927', 
'MPOS153060126772312', 
'MPOS153070157455700', 
'MPOS153080171934408', 
'MPOS153080110149663', 
'MPOS153080106141595', 
'MPOS153080116586919', 
'MPOS153080117627789', 
'MPOS153090180444589', 
'MPOS153090121442935', 
'MPOS153090123197648', 
'MPOS153100194712887', 
'MPOS153100167683633', 
'MPOS153120118403356', 
'MPOS153130133731407', 
'MPOS153130188876641', 
'MPOS153130151737105', 
'MPOS153100129432919', 
'MPOS153130130423876', 
'MPOS153130141616805', 
'MPOS153130121407195', 
'MPOS153130114047918', 
'MPOS153130134893508', 
'MPOS153130192454812', 
'MPOS153130134747495', 
'MPOS153130174365095', 
'MPOS153130106946130', 
'MPOS153130163238333'
) ;



select b.sale_amount,b.amount,a.sale_amount,a.amount from t_star_member_sales_detail a 
inner join 
t_star_member_sales_detail b
on a.order_no=b.order_no and a.item_num_id=b.item_num_id
where  b.order_no in('MPOS153160116157025',
'MPOS153100129432919',
'MPOS153080117627789',
'MPOS153120118403356',
'MPOS153130192454812',
'MPOS153130114047918',
'MPOS153150150945528',
'MPOS153140188002803',
'MPOS153130163238333',
'MPOS153150102197682',
'MPOS153140188529299',
'MPOS153090180444589',
'MPOS153140140352593',
'MPOS153130134747495',
'MPOS153140114914572',
'MPOS153150124317172',
'MPOS153140198779722',
'MPOS153130194148064',
'MPOS153150108804893',
'MPOS153130121407195',
'MPOS153150195825145',
'MPOS153150134507278',
'MPOS153080116586919',
'MPOS153140176006420',
'MPOS153130133731407',
'MPOS153090123197648',
'MPOS153090121442935',
'MPOS153130141616805',
'MPOS153130130423876',
'MPOS153140166597303',
'MPOS153130174365095',
'MPOS153150180102803',
'MPOS153130134893508',
'MPOS153150172459571',
'MPOS153150151494836',
'MPOS153130106946130',
'MPOS153140174451742',
'MPOS153060126772312',
'MPOS153100176117733',
'MPOS153130151737105',
'MPOS153140189045399',
'MPOS153100167683633',
'MPOS153130188876641',
'MPOS153100194712887',
'MPOS153150181940628',
'MPOS153080110149663',
'MPOS153080171934408',
'MPOS153060126448927',
'MPOS153030155965536',
'MPOS153080106141595',
'MPOS153070157455700',
'MPOS153150185281169',
'MPOS153140102501524',
'MPOS153150118528352')
and b.operate_type=2
and b.good_count>1 
and a.order_no in(
'MPOS153160116157025',
'MPOS153100129432919',
'MPOS153080117627789',
'MPOS153120118403356',
'MPOS153130192454812',
'MPOS153130114047918',
'MPOS153150150945528',
'MPOS153140188002803',
'MPOS153130163238333',
'MPOS153150102197682',
'MPOS153140188529299',
'MPOS153090180444589',
'MPOS153140140352593',
'MPOS153130134747495',
'MPOS153140114914572',
'MPOS153150124317172',
'MPOS153140198779722',
'MPOS153130194148064',
'MPOS153150108804893',
'MPOS153130121407195',
'MPOS153150195825145',
'MPOS153150134507278',
'MPOS153080116586919',
'MPOS153140176006420',
'MPOS153130133731407',
'MPOS153090123197648',
'MPOS153090121442935',
'MPOS153130141616805',
'MPOS153130130423876',
'MPOS153140166597303',
'MPOS153130174365095',
'MPOS153150180102803',
'MPOS153130134893508',
'MPOS153150172459571',
'MPOS153150151494836',
'MPOS153130106946130',
'MPOS153140174451742',
'MPOS153060126772312',
'MPOS153100176117733',
'MPOS153130151737105',
'MPOS153140189045399',
'MPOS153100167683633',
'MPOS153130188876641',
'MPOS153100194712887',
'MPOS153150181940628',
'MPOS153080110149663',
'MPOS153080171934408',
'MPOS153060126448927',
'MPOS153030155965536',
'MPOS153080106141595',
'MPOS153070157455700',
'MPOS153150185281169',
'MPOS153140102501524',
'MPOS153150118528352')
and a.operate_type=1 
and a.sale_amount!=-b.sale_amount;


update t_star_member_sales_detail a 
inner join 
t_star_member_sales_detail b
on a.order_no=b.order_no and a.item_num_id=b.item_num_id
set b.amount=-a.amount,a.sale_amount=0
where  b.order_no in('MPOS153030155965536', 
'MPOS153060126448927', 
'MPOS153060126772312', 
'MPOS153070157455700', 
'MPOS153080171934408', 
'MPOS153080110149663', 
'MPOS153080106141595', 
'MPOS153080116586919', 
'MPOS153080117627789', 
'MPOS153090180444589', 
'MPOS153090121442935', 
'MPOS153090123197648', 
'MPOS153100194712887', 
'MPOS153100167683633', 
'MPOS153120118403356', 
'MPOS153130133731407', 
'MPOS153130188876641', 
'MPOS153130151737105', 
'MPOS153100129432919', 
'MPOS153130130423876', 
'MPOS153130141616805', 
'MPOS153130121407195', 
'MPOS153130114047918', 
'MPOS153130134893508', 
'MPOS153130192454812', 
'MPOS153130134747495', 
'MPOS153130174365095', 
'MPOS153130106946130', 
'MPOS153130163238333')
and b.operate_type=2
and b.good_count>1 
and a.order_no in(
'MPOS153030155965536', 
'MPOS153060126448927', 
'MPOS153060126772312', 
'MPOS153070157455700', 
'MPOS153080171934408', 
'MPOS153080110149663', 
'MPOS153080106141595', 
'MPOS153080116586919', 
'MPOS153080117627789', 
'MPOS153090180444589', 
'MPOS153090121442935', 
'MPOS153090123197648', 
'MPOS153100194712887', 
'MPOS153100167683633', 
'MPOS153120118403356', 
'MPOS153130133731407', 
'MPOS153130188876641', 
'MPOS153130151737105', 
'MPOS153100129432919', 
'MPOS153130130423876', 
'MPOS153130141616805', 
'MPOS153130121407195', 
'MPOS153130114047918', 
'MPOS153130134893508', 
'MPOS153130192454812', 
'MPOS153130134747495', 
'MPOS153130174365095', 
'MPOS153130106946130', 
'MPOS153130163238333')
and a.operate_type=1 ;



select * from t_star_member_sales where 
order_no in('MPOS153160116157025',
'MPOS153100129432919',
'MPOS153080117627789',
'MPOS153120118403356',
'MPOS153130192454812',
'MPOS153130114047918',
'MPOS153150150945528',
'MPOS153140188002803',
'MPOS153130163238333',
'MPOS153150102197682',
'MPOS153140188529299',
'MPOS153090180444589',
'MPOS153140140352593',
'MPOS153130134747495',
'MPOS153140114914572',
'MPOS153150124317172',
'MPOS153140198779722',
'MPOS153130194148064',
'MPOS153150108804893',
'MPOS153130121407195',
'MPOS153150195825145',
'MPOS153150134507278',
'MPOS153080116586919',
'MPOS153140176006420',
'MPOS153130133731407',
'MPOS153090123197648',
'MPOS153090121442935',
'MPOS153130141616805',
'MPOS153130130423876',
'MPOS153140166597303',
'MPOS153130174365095',
'MPOS153150180102803',
'MPOS153130134893508',
'MPOS153150172459571',
'MPOS153150151494836',
'MPOS153130106946130',
'MPOS153140174451742',
'MPOS153060126772312',
'MPOS153100176117733',
'MPOS153130151737105',
'MPOS153140189045399',
'MPOS153100167683633',
'MPOS153130188876641',
'MPOS153100194712887',
'MPOS153150181940628',
'MPOS153080110149663',
'MPOS153080171934408',
'MPOS153060126448927',
'MPOS153030155965536',
'MPOS153080106141595',
'MPOS153070157455700',
'MPOS153150185281169',
'MPOS153140102501524',
'MPOS153150118528352');
